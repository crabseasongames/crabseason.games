<html>
<head>
<style>

body {
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

 canvas {
  border: 4px solid black;
} 

</style>

</head>
<body>
<canvas id="canvas" width="800" height="800"></canvas>
<script>

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const lightSquare = '#c1861a';
const darkSquare = '#956205';
const highlightedColor = '#ef4141';
const tuggColor = '#fff';
const oofColor = '#000';
/// empty = 0, ORock = 1, Oguy = 2, TRock = 3, TGuy = 4
const startingBoard = [
  [3, 3, 3, 4, 3, 3, 3, 3],
  [3, 3, 3, 3, 3, 3, 3, 3],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0],
  [1, 1, 1, 1, 1, 1, 1, 1],
  [1, 1, 1, 2, 1, 1, 1, 1]
];

const empty = () => { return [ [], [], [], [], [], [], [], [] ]; };

let highlightedSquares = empty();
let allowedMoves = empty();
let activePiece = false;

let board = startingBoard;
let moveMode = false;

function drawBoard() {
  for (let i = 0; i < 8; i++) {
    for (let j = 0; j < 8; j++) {
      let color = (i + j) % 2 == 0 ? lightSquare : darkSquare;
      ctx.fillStyle = color ;
      ctx.fillRect(i * 100, j * 100, 100, 100);

      if (highlightedSquares[i][j] || allowedMoves[i][j]) {
        ctx.fillStyle = highlightedColor;
        ctx.fillRect(i * 100, j * 100, 100, 100);
        ctx.fillStyle = color;
        ctx.fillRect(i * 100 + 10, j * 100 + 10, 80, 80);
      }

      let piece = board[j][i];
      if (piece){
        drawPiece([i, j], piece);
      }
    }
  }
}

function drawPiece(position, piece) {
  let pieceColor = (piece == 1 || piece == 2) ? oofColor : tuggColor
  if (piece == 1 || piece == 3){
    ctx.beginPath();
    ctx.arc(100*position[0] + 50, 100*position[1] + 50, 33, 0, 2*Math.PI)
    ctx.fillStyle = pieceColor;
    ctx.fill()
  } else {
    ctx.beginPath();
    ctx.arc(100*position[0] + 50, 100*position[1] + 50, 15, 0, 2*Math.PI)
    ctx.moveTo(100 * position[0] + 10 , 100 * position[1] + 10);
    ctx.lineTo(100 * position[0] + 50, 100 * position[1] + 50);
    ctx.lineTo(100 * position[0] + 10, 100 * position[1] + 90);
    ctx.lineTo(100 * position[0] + 90, 100 * position[1] + 90);
    ctx.lineTo(100 * position[0] + 50, 100 * position[1] + 50);
    ctx.lineTo(100 * position[0] + 90, 100 * position[1] + 10);
    ctx.lineTo(100 * position[0] + 100, 100 * position[1] + 10);
    ctx.fillStyle = pieceColor;
    ctx.fill()
    ctx.closePath();
  }
}

function getPosition(x, y) {
  let bound = (c) => { return Math.min(799, Math.max(0, c)); };
  return([Math.floor(bound(x) / 100), Math.floor(bound(y) / 100)]);
}

function isOpposing(pa, pb) {
  return (
    (board[pa[1]][pa[0]] == 1 || board[pa[1]][pa[0]] == 2) &&
    (board[pb[1]][pb[0]] == 3 || board[pb[1]][pb[0]] == 4)
  ) || (
    (board[pa[1]][pa[0]] == 3 || board[pa[1]][pa[0]] == 4) &&
    (board[pb[1]][pb[0]] == 1 || board[pb[1]][pb[0]] == 2)
  );
}

function getAllowedMoves(position) {
    let allowedMoves = empty();
    let i = position[0];
    while (++i < 8 && !board[position[1]][i]) {
      allowedMoves[i][position[1]] = true;
    }
    if (i < 8) {
      allowedMoves[i][position[1]] = isOpposing(position, [i, position[1]]);  
    }

    i = position[0];
    while (--i >= 0 && !board[position[1]][i]) {
      allowedMoves[i][position[1]] = true;
    }
    if (i >= 0) {
      allowedMoves[i][position[1]] = isOpposing(position, [i, position[1]]);  
    }

    i = position[1];
    while (++i < 8 && !board[i][position[0]]) {
      allowedMoves[position[0]][i] = true;
    }
    if (i < 8) {
      allowedMoves[position[0]][i] = isOpposing(position, [position[0], i]);  
    }

    i = position[1];
    while (--i >= 0 && !board[i][position[0]]) {
      allowedMoves[position[0]][i] = true;
    }
    if (i >= 0) {
      allowedMoves[position[0]][i] = isOpposing(position, [position[0], i]);  
    }

    return allowedMoves;
}

canvas.addEventListener("mousemove", (e)=>{
  let position = getPosition(e.offsetX, e.offsetY);
  if (!moveMode) {
    highlightedSquares = empty();
    highlightedSquares[position[0]][position[1]] = true;
    drawBoard();
  }
});

canvas.addEventListener("click", (e) => {
  let position = getPosition(e.offsetX, e.offsetY);
  let piece = board[position[1]][position[0]];
  if (!moveMode && piece) {
    moveMode = true;
    highlightedSquares = empty();
    allowedMoves = getAllowedMoves(position);
    activePiece = position;
  } else if (moveMode) {
    if (allowedMoves[position[0]][position[1]]) {
      board[position[1]][position[0]] = board[activePiece[1]][activePiece[0]];
      board[activePiece[1]][activePiece[0]] = 0;
    }
    highlightedSquares = empty();
    allowedMoves = empty();
    moveMode = false;
  }
  drawBoard();
});

drawBoard();

</script>
</body>
</html>